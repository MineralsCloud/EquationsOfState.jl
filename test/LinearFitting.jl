using Test

using EquationsOfState.FiniteStrains
using EquationsOfState.LinearFitting

@testset "Test strain-volume-derivative" begin
    volumes = [
        25.987454833,
        26.9045702104,
        27.8430241908,
        28.8029649591,
        29.7848370694,
        30.7887887064,
        31.814968055,
        32.8638196693,
        33.9353435494,
        35.0299842495,
        36.1477417695,
        37.2892088485,
        38.4543854865,
        39.6437162376,
        40.857201102,
        42.095136449,
        43.3579668329,
        44.6456922537,
        45.9587572656,
        47.2973100535,
        48.6614988019,
        50.0517680652,
        51.4682660281,
        52.9112890601,
        54.3808371612,
        55.8775030703,
        57.4014349722,
        58.9526328669,
    ]
    v0 = 40.98926572870838
    @test [strain_volume_derivative(EulerianStrain(), v0, v, 3) for v in volumes] ≈ [
        -0.00025163164656036914,
        -0.00022158317701314234,
        -0.0001954064296869249,
        -0.00017256893337511754,
        -0.00015261005948744114,
        -0.00013514276136071226,
        -0.00011983495896811362,
        -0.00010639785139417004,
        -9.458902516425933e-5,
        -8.419491823560175e-5,
        -7.503571748024374e-5,
        -6.695156194310254e-5,
        -5.980866702052554e-5,
        -5.348840953851233e-5,
        -4.789028506457302e-5,
        -4.2925492613058147e-5,
        -3.85164573279167e-5,
        -3.459717265567486e-5,
        -3.110870879523787e-5,
        -2.8000473828556818e-5,
        -2.5228159545528874e-5,
        -2.275242969867225e-5,
        -2.0539381634855355e-5,
        -1.855902166896191e-5,
        -1.6785363112484185e-5,
        -1.5194859884358581e-5,
        -1.3767304534537318e-5,
        -1.2484962604556655e-5,
    ]
    @test [strain_volume_derivative(LagrangianStrain(), v0, v, 3) for v in volumes] ≈ [
        -4.360792585446927e-5,
        -4.021795998862133e-5,
        -3.7125806529670504e-5,
        -3.430262724447532e-5,
        -3.172185978064063e-5,
        -2.9360589247189284e-5,
        -2.719823329453535e-5,
        -2.5215761270023045e-5,
        -2.3396932620829496e-5,
        -2.172639361674028e-5,
        -2.0191013020817355e-5,
        -1.8778177794469247e-5,
        -1.7477278166117428e-5,
        -1.6278235883744374e-5,
        -1.5172392867363944e-5,
        -1.4151626497343523e-5,
        -1.3208496564809248e-5,
        -1.2336591903572137e-5,
        -1.1529793498552908e-5,
        -1.0782740265865238e-5,
        -1.009054720444801e-5,
        -9.448630234274912e-6,
        -8.852961760583228e-6,
        -8.299807942932397e-6,
        -7.78586914649821e-6,
        -7.307932527332951e-6,
        -6.863217457745042e-6,
        -6.449212613211634e-6,
    ]
    @test [strain_volume_derivative(NaturalStrain(), v0, v, 3) for v in volumes] ≈ [
        0.00011395640842831919,
        0.00010269559592471744,
        9.265754335710983e-5,
        8.369864119123017e-5,
        7.569101157907677e-5,
        6.852549573283301e-5,
        6.210628060176279e-5,
        5.634765917870933e-5,
        5.117681395143497e-5,
        4.6527548395465794e-5,
        4.234347362622052e-5,
        3.857273983853629e-5,
        3.517161972472347e-5,
        3.2100139446683775e-5,
        2.9324064018820016e-5,
        2.681230993011352e-5,
        2.4537102053587615e-5,
        2.2474565886168472e-5,
        2.0602748703699993e-5,
        1.890256196526239e-5,
        1.7356955567635e-5,
        1.5950405389513548e-5,
        1.466936735556791e-5,
        1.3501591655278468e-5,
        1.2436332606671682e-5,
        1.1463547171440715e-5,
        1.0574546405738849e-5,
        9.761585855581402e-6,
    ]
    @test [strain_volume_derivative(InfinitesimalStrain(), v0, v, 3) for v in volumes] ≈ [
        0.00017195382081596378,
        0.00015318072693119346,
        0.0001366374157858279,
        0.00012203947625819057,
        0.00010913738901171863,
        9.77197419230021e-5,
        8.76030749059566e-5,
        7.862563981068296e-5,
        7.065075730232455e-5,
        6.355618910218268e-5,
        5.723834723338108e-5,
        5.160365044520063e-5,
        4.657341353283599e-5,
        4.207684089417924e-5,
        3.80535882418961e-5,
        3.444963171076881e-5,
        3.1217248819476426e-5,
        2.8315601024208774e-5,
        2.5707710435800747e-5,
        2.3361614304347095e-5,
        2.1249043437552616e-5,
        1.9344592130116945e-5,
        1.7626220489559587e-5,
        1.6074217776270604e-5,
        1.4671393271712412e-5,
        1.3401940487277108e-5,
        1.2252230465391096e-5,
        1.121020710562245e-5,
    ]
end
